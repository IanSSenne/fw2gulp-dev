function e(t,s,n){let o;return"#text"===t.nodeName?o=n.document.createTextNode(t.data):"#comment"===t.nodeName?o=n.document.createComment(t.data):("svg"===t.nodeName||s?(o=n.document.createElementNS("http://www.w3.org/2000/svg",t.nodeName),s=!0):o=n.document.createElement(t.nodeName),t.attributes&&Object.entries(t.attributes).forEach(([e,t])=>o.setAttribute(e,t)),t.childNodes&&t.childNodes.forEach(t=>o.appendChild(e(t,s,n))),n.valueDiffing&&(t.value&&(o.value=t.value),t.checked&&(o.checked=t.checked),t.selected&&(o.selected=t.selected))),o}function t(e,t){for(t=t.slice();t.length>0;){if(!e.childNodes)return!1;const s=t.splice(0,1)[0];e=e.childNodes[s]}return e}function s(s,n,o){let i,l,a,c,r,u=t(s,n[o._const.route]);const h={diff:n,node:u};if(o.preDiffApply(h))return!0;switch(n[o._const.action]){case o._const.addAttribute:if(!u||!u.setAttribute)return!1;u.setAttribute(n[o._const.name],n[o._const.value]);break;case o._const.modifyAttribute:if(!u||!u.setAttribute)return!1;u.setAttribute(n[o._const.name],n[o._const.newValue]),"INPUT"===u.nodeName&&"value"===n[o._const.name]&&(u.value=n[o._const.newValue]);break;case o._const.removeAttribute:if(!u||!u.removeAttribute)return!1;u.removeAttribute(n[o._const.name]);break;case o._const.modifyTextElement:if(!u||3!==u.nodeType)return!1;o.textDiff(u,u.data,n[o._const.oldValue],n[o._const.newValue]);break;case o._const.modifyValue:if(!u||void 0===u.value)return!1;u.value=n[o._const.newValue];break;case o._const.modifyComment:if(!u||void 0===u.data)return!1;o.textDiff(u,u.data,n[o._const.oldValue],n[o._const.newValue]);break;case o._const.modifyChecked:if(!u||void 0===u.checked)return!1;u.checked=n[o._const.newValue];break;case o._const.modifySelected:if(!u||void 0===u.selected)return!1;u.selected=n[o._const.newValue];break;case o._const.replaceElement:u.parentNode.replaceChild(e(n[o._const.newValue],"http://www.w3.org/2000/svg"===u.namespaceURI,o),u);break;case o._const.relocateGroup:(c=Array(...new Array(n.groupLength)).map(()=>u.removeChild(u.childNodes[n[o._const.from]]))).forEach((e,t)=>{0===t&&(l=u.childNodes[n[o._const.to]]),u.insertBefore(e,l||null)});break;case o._const.removeElement:u.parentNode.removeChild(u);break;case o._const.addElement:r=(a=n[o._const.route].slice()).splice(a.length-1,1)[0],(u=t(s,a)).insertBefore(e(n[o._const.element],"http://www.w3.org/2000/svg"===u.namespaceURI,o),u.childNodes[r]||null);break;case o._const.removeTextElement:if(!u||3!==u.nodeType)return!1;u.parentNode.removeChild(u);break;case o._const.addTextElement:if(r=(a=n[o._const.route].slice()).splice(a.length-1,1)[0],i=o.document.createTextNode(n[o._const.value]),!(u=t(s,a))||!u.childNodes)return!1;u.insertBefore(i,u.childNodes[r]||null);break;default:console.log("unknown action")}return h.newNode=i,o.postDiffApply(h),!0}function n(e,t,n){return t.every(t=>s(e,t,n))}function o(e,t,s){const n=e[t];e[t]=e[s],e[s]=n}function i(e,t,n){switch(t[n._const.action]){case n._const.addAttribute:t[n._const.action]=n._const.removeAttribute,s(e,t,n);break;case n._const.modifyAttribute:o(t,n._const.oldValue,n._const.newValue),s(e,t,n);break;case n._const.removeAttribute:t[n._const.action]=n._const.addAttribute,s(e,t,n);break;case n._const.modifyTextElement:case n._const.modifyValue:case n._const.modifyComment:case n._const.modifyChecked:case n._const.modifySelected:case n._const.replaceElement:o(t,n._const.oldValue,n._const.newValue),s(e,t,n);break;case n._const.relocateGroup:o(t,n._const.from,n._const.to),s(e,t,n);break;case n._const.removeElement:t[n._const.action]=n._const.addElement,s(e,t,n);break;case n._const.addElement:t[n._const.action]=n._const.removeElement,s(e,t,n);break;case n._const.removeTextElement:t[n._const.action]=n._const.addTextElement,s(e,t,n);break;case n._const.addTextElement:t[n._const.action]=n._const.removeTextElement,s(e,t,n);break;default:console.log("unknown action")}}function l(e,t,s){t.length||(t=[t]),(t=t.slice()).reverse(),t.forEach(t=>{i(e,t,s)})}class a{constructor(e={}){Object.entries(e).forEach(([e,t])=>this[e]=t)}toString(){return JSON.stringify(this)}setValue(e,t){return this[e]=t,this}}function c(e){const t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(`${e.nodeName}.${e.attributes.class.replace(/ /g,".")}`),e.attributes.id&&t.push(`${e.nodeName}#${e.attributes.id}`))),t}function r(e){const t={},s={};return e.forEach(e=>{c(e).forEach(e=>{const n=e in t;n||e in s?n&&(delete t[e],s[e]=!0):t[e]=!0})}),t}function u(e,t){const s=r(e),n=r(t),o={};return Object.keys(s).forEach(e=>{n[e]&&(o[e]=!0)}),o}function h(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(h)}function d(e,t){if(!["nodeName","value","checked","selected","data"].every(s=>e[s]===t[s]))return!1;if(Boolean(e.attributes)!==Boolean(t.attributes))return!1;if(Boolean(e.childNodes)!==Boolean(t.childNodes))return!1;if(e.attributes){const s=Object.keys(e.attributes),n=Object.keys(t.attributes);if(s.length!==n.length)return!1;if(!s.every(s=>e.attributes[s]===t.attributes[s]))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every((e,s)=>d(e,t.childNodes[s])))return!1}return!0}function f(e,t,s,n,o){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!o||e.data===t.data;if(e.nodeName in s)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(`${e.nodeName}#${e.attributes.id}`in s)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class){if(`${e.nodeName}.${e.attributes.class.replace(/ /g,".")}`in s)return!0}}if(n)return!0;const i=e.childNodes?e.childNodes.slice().reverse():[],l=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==l.length)return!1;if(o)return i.every((e,t)=>e.nodeName===l[t].nodeName);{const e=u(i,l);return i.every((t,s)=>f(t,l[s],e,!0,!0))}}function p(e){return JSON.parse(JSON.stringify(e))}function m(e,t,s,n){let o=0,i=[];const l=e.length,a=t.length,r=Array(...new Array(l+1)).map(()=>[]),h=u(e,t);let d=l===a;d&&e.some((e,s)=>{const n=c(e),o=c(t[s]);return n.length!==o.length?(d=!1,!0):(n.some((e,t)=>{if(e!==o[t])return d=!1,!0}),!d||void 0)});for(let c=0;c<l;c++){const l=e[c];for(let e=0;e<a;e++){const a=t[e];s[c]||n[e]||!f(l,a,h,d)?r[c+1][e+1]=0:(r[c+1][e+1]=r[c][e]?r[c][e]+1:1,r[c+1][e+1]>=o&&(o=r[c+1][e+1],i=[c+1,e+1]))}}return 0!==o&&{oldValue:i[0]-o,newValue:i[1]-o,length:o}}function _(e,t){return Array(...new Array(e)).map(()=>t)}function V(e,t,s){const n=e.childNodes?_(e.childNodes.length,!0):[],o=t.childNodes?_(t.childNodes.length,!0):[];let i=0;return s.forEach(e=>{const t=e.oldValue+e.length,s=e.newValue+e.length;for(let s=e.oldValue;s<t;s+=1)n[s]=i;for(let t=e.newValue;t<s;t+=1)o[t]=i;i+=1}),{gaps1:n,gaps2:o}}function g(e,t){const s=e.childNodes?e.childNodes:[],n=t.childNodes?t.childNodes:[],o=_(s.length,!1),i=_(n.length,!1),l=[];let a=!0;const c=function(){return arguments[1]};for(;a;)if(a=m(s,n,o,i)){l.push(a),Array(...new Array(a.length)).map(c).forEach(e=>(r=e,o[a.oldValue+r]=!0,void(i[a.newValue+r]=!0)))}var r;return e.subsets=l,e.subsetsAge=100,l}class b{constructor(){this.list=[]}add(e){this.list.push(...e)}forEach(e){this.list.forEach(t=>e(t))}}function N(e,t){let s,n,o=e;for(t=t.slice();t.length>0;){if(!o.childNodes)return!1;n=t.splice(0,1)[0],s=o,o=o.childNodes[n]}return{node:o,parentNode:s,nodeIndex:n}}function v(e,t,s){const n=N(e,t[s._const.route]);let o=n.node;const i=n.parentNode,l=n.nodeIndex,a=[],c={diff:t,node:o};if(s.preDiffApply(c))return!0;let r,u,h,d;switch(t[s._const.action]){case s._const.addAttribute:o.attributes||(o.attributes={}),o.attributes[t[s._const.name]]=t[s._const.value],"checked"===t[s._const.name]?o.checked=!0:"selected"===t[s._const.name]?o.selected=!0:"INPUT"===o.nodeName&&"value"===t[s._const.name]&&(o.value=t[s._const.value]);break;case s._const.modifyAttribute:o.attributes[t[s._const.name]]=t[s._const.newValue];break;case s._const.removeAttribute:delete o.attributes[t[s._const.name]],0===Object.keys(o.attributes).length&&delete o.attributes,"checked"===t[s._const.name]?o.checked=!1:"selected"===t[s._const.name]?delete o.selected:"INPUT"===o.nodeName&&"value"===t[s._const.name]&&delete o.value;break;case s._const.modifyTextElement:o.data=t[s._const.newValue];break;case s._const.modifyValue:o.value=t[s._const.newValue];break;case s._const.modifyComment:o.data=t[s._const.newValue];break;case s._const.modifyChecked:o.checked=t[s._const.newValue];break;case s._const.modifySelected:o.selected=t[s._const.newValue];break;case s._const.replaceElement:(r=p(t[s._const.newValue])).outerDone=!0,r.innerDone=!0,r.valueDone=!0,i.childNodes[l]=r;break;case s._const.relocateGroup:(u=o.childNodes.splice(t[s._const.from],t.groupLength).reverse()).forEach(e=>o.childNodes.splice(t[s._const.to],0,e)),o.subsets&&o.subsets.forEach(e=>{if(t[s._const.from]<t[s._const.to]&&e.oldValue<=t[s._const.to]&&e.oldValue>t[s._const.from]){e.oldValue-=t.groupLength;const n=e.oldValue+e.length-t[s._const.to];n>0&&(a.push({oldValue:t[s._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else if(t[s._const.from]>t[s._const.to]&&e.oldValue>t[s._const.to]&&e.oldValue<t[s._const.from]){e.oldValue+=t.groupLength;const n=e.oldValue+e.length-t[s._const.to];n>0&&(a.push({oldValue:t[s._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else e.oldValue===t[s._const.from]&&(e.oldValue=t[s._const.to])});break;case s._const.removeElement:i.childNodes.splice(l,1),i.subsets&&i.subsets.forEach(e=>{e.oldValue>l?e.oldValue-=1:e.oldValue===l?e.delete=!0:e.oldValue<l&&e.oldValue+e.length>l&&(e.oldValue+e.length-1===l?e.length--:(a.push({newValue:e.newValue+l-e.oldValue,oldValue:l,length:e.length-l+e.oldValue-1}),e.length=l-e.oldValue))}),o=i;break;case s._const.addElement:h=t[s._const.route].slice(),d=h.splice(h.length-1,1)[0],o=N(e,h).node,(r=p(t[s._const.element])).outerDone=!0,r.innerDone=!0,r.valueDone=!0,o.childNodes||(o.childNodes=[]),d>=o.childNodes.length?o.childNodes.push(r):o.childNodes.splice(d,0,r),o.subsets&&o.subsets.forEach(e=>{if(e.oldValue>=d)e.oldValue+=1;else if(e.oldValue<d&&e.oldValue+e.length>d){const t=e.oldValue+e.length-d;a.push({newValue:e.newValue+e.length-t,oldValue:d+1,length:t}),e.length-=t}});break;case s._const.removeTextElement:i.childNodes.splice(l,1),"TEXTAREA"===i.nodeName&&delete i.value,i.subsets&&i.subsets.forEach(e=>{e.oldValue>l?e.oldValue-=1:e.oldValue===l?e.delete=!0:e.oldValue<l&&e.oldValue+e.length>l&&(e.oldValue+e.length-1===l?e.length--:(a.push({newValue:e.newValue+l-e.oldValue,oldValue:l,length:e.length-l+e.oldValue-1}),e.length=l-e.oldValue))}),o=i;break;case s._const.addTextElement:h=t[s._const.route].slice(),d=h.splice(h.length-1,1)[0],(r={}).nodeName="#text",r.data=t[s._const.value],(o=N(e,h).node).childNodes||(o.childNodes=[]),d>=o.childNodes.length?o.childNodes.push(r):o.childNodes.splice(d,0,r),"TEXTAREA"===o.nodeName&&(o.value=t[s._const.newValue]),o.subsets&&o.subsets.forEach(e=>{if(e.oldValue>=d&&(e.oldValue+=1),e.oldValue<d&&e.oldValue+e.length>d){const t=e.oldValue+e.length-d;a.push({newValue:e.newValue+e.length-t,oldValue:d+1,length:t}),e.length-=t}});break;default:console.log("unknown action")}o.subsets&&(o.subsets=o.subsets.filter(e=>!e.delete&&e.oldValue!==e.newValue),a.length&&(o.subsets=o.subsets.concat(a))),c.newNode=r,s.postDiffApply(c)}function w(e,t,s){return t.forEach(t=>{v(e,t,s)}),!0}function y(e,t={}){const s={};if(s.nodeName=e.nodeName,"#text"===s.nodeName||"#comment"===s.nodeName)s.data=e.data;else{if(e.attributes&&e.attributes.length>0){s.attributes={},Array.prototype.slice.call(e.attributes).forEach(e=>s.attributes[e.name]=e.value)}if("TEXTAREA"===s.nodeName)s.value=e.value;else if(e.childNodes&&e.childNodes.length>0){s.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(e=>s.childNodes.push(y(e,t)))}t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?s.checked=e.checked:void 0!==e.value&&(s.value=e.value),void 0!==e.selected&&(s.selected=e.selected))}return s}const E=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,k=Object.create?Object.create(null):{},A=/([\w-:]+)|(['"])([^'"]*)\2/g,D={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function x(e){let t,s=0;const n={nodeName:""};return e.replace(A,o=>{s%2?t=o:0===s?((D[o]||"/"===e.charAt(e.length-2))&&(n.voidElement=!0),n.nodeName=o.toUpperCase()):(n.attributes||(n.attributes={}),n.attributes[t]=o.replace(/^['"]|['"]$/g,"")),s++}),n}function O(e,t={components:k}){const s=[];let n,o=-1;const i=[],l={};let a=!1;return e.replace(E,(c,r)=>{if(a){if(c!==`</${n.nodeName}>`)return;a=!1}const u="/"!==c.charAt(1),h=r+c.length,d=e.charAt(h);let f;if(u&&(o++,"tag"===(n=x(c)).type&&t.components[n.nodeName]&&(n.type="component",a=!0),n.voidElement||a||!d||"<"===d||(n.childNodes||(n.childNodes=[]),n.childNodes.push({nodeName:"#text",data:e.slice(h,e.indexOf("<",h))})),l[n.tagName]=n,0===o&&s.push(n),(f=i[o-1])&&(f.childNodes||(f.childNodes=[]),f.childNodes.push(n)),i[o]=n),(!u||n.voidElement)&&(o--,!a&&"<"!==d&&d)){f=-1===o?s:i[o].childNodes||[];const t=e.indexOf("<",h),n=e.slice(h,-1===t?void 0:t);f.push({nodeName:"#text",data:n})}}),s[0]}function T(e){return delete e.voidElement,e.childNodes&&e.childNodes.forEach(e=>T(e)),e}function C(e){return T(O(e))}class R{constructor(e,t,s){this.options=s,this.t1=e instanceof HTMLElement?y(e,this.options):"string"==typeof e?C(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=t instanceof HTMLElement?y(t,this.options):"string"==typeof t?C(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=y(e,this.options),this.t2Orig=y(t,this.options)),this.tracker=new b}init(){return this.findDiffs(this.t1,this.t2)}findDiffs(e,t){let s;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error(`surpassed diffcap:${JSON.stringify(this.t1Orig)} -> ${JSON.stringify(this.t2Orig)}`);0===(s=this.findNextDiff(e,t,[])).length&&(d(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,h(e),s=this.findNextDiff(e,t,[])))),s.length>0&&(this.foundAll=!1,this.tracker.add(s),w(e,s,this.options))}while(s.length>0);return this.tracker.list}findNextDiff(e,t,s){let n,o;if(this.options.maxDepth&&s.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,s),this.options.filterOuterDiff&&(o=this.options.filterOuterDiff(e,t,n))&&(n=o),n.length>0)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if((n=this.findInnerDiff(e,t,s)).length>0)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if((n=this.findValueDiff(e,t,s)).length>0)return e.valueDone=!0,n;e.valueDone=!0}return[]}findOuterDiff(e,t,s){const n=[];let o,i,l,c,r,u;if(e.nodeName!==t.nodeName){if(!s.length)throw new Error("Top level nodes have to be of the same kind.");return[(new a).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,p(e)).setValue(this.options._const.newValue,p(t)).setValue(this.options._const.route,s)]}if(s.length&&this.options.maxNodeDiffCount<Math.abs((e.childNodes||[]).length-(t.childNodes||[]).length))return[(new a).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,p(e)).setValue(this.options._const.newValue,p(t)).setValue(this.options._const.route,s)];if(e.data!==t.data)return"#text"===e.nodeName?[(new a).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,s).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[(new a).setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,s).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(i=e.attributes?Object.keys(e.attributes).sort():[],l=t.attributes?Object.keys(t.attributes).sort():[],c=i.length,u=0;u<c;u++)o=i[u],-1===(r=l.indexOf(o))?n.push((new a).setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,s).setValue(this.options._const.name,o).setValue(this.options._const.value,e.attributes[o])):(l.splice(r,1),e.attributes[o]!==t.attributes[o]&&n.push((new a).setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,s).setValue(this.options._const.name,o).setValue(this.options._const.oldValue,e.attributes[o]).setValue(this.options._const.newValue,t.attributes[o])));for(c=l.length,u=0;u<c;u++)o=l[u],n.push((new a).setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,s).setValue(this.options._const.name,o).setValue(this.options._const.value,t.attributes[o]));return n}findInnerDiff(e,t,s){const n=e.childNodes?e.childNodes.slice():[],o=t.childNodes?t.childNodes.slice():[],i=Math.max(n.length,o.length);let l=Math.abs(n.length-o.length),c=[],r=0;if(!this.options.maxChildCount||i<this.options.maxChildCount){const n=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?g(e,t):[];if(n.length>0&&(c=this.attemptGroupRelocation(e,t,n,s)).length>0)return c}for(let e=0;e<i;e+=1){const t=n[e],u=o[e];l&&(t&&!u?"#text"===t.nodeName?(c.push((new a).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,s.concat(r)).setValue(this.options._const.value,t.data)),r-=1):(c.push((new a).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,s.concat(r)).setValue(this.options._const.element,p(t))),r-=1):u&&!t&&("#text"===u.nodeName?c.push((new a).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,s.concat(r)).setValue(this.options._const.value,u.data)):c.push((new a).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,s.concat(r)).setValue(this.options._const.element,p(u))))),t&&u&&(!this.options.maxChildCount||i<this.options.maxChildCount?c=c.concat(this.findNextDiff(t,u,s.concat(r))):d(t,u)||(n.length>o.length?(c=c.concat([(new a).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,p(t)).setValue(this.options._const.route,s.concat(r))]),n.splice(e,1),r-=1,l-=1):n.length<o.length?(c=c.concat([(new a).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,p(u)).setValue(this.options._const.route,s.concat(r))]),n.splice(e,0,{}),l-=1):c=c.concat([(new a).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,p(t)).setValue(this.options._const.newValue,p(u)).setValue(this.options._const.route,s.concat(r))]))),r+=1}return e.innerDone=!0,c}attemptGroupRelocation(e,t,s,n){const o=V(e,t,s),i=o.gaps1,l=o.gaps2;let c,r,u,h,d,m,_=Math.min(i.length,l.length);const g=[];for(let o=0,V=0;o<_;V+=1,o+=1)if(!0===i[o])if("#text"===(h=e.childNodes[V]).nodeName){if("#text"===t.childNodes[o].nodeName&&h.data!==t.childNodes[o].data){for(m=V;e.childNodes.length>m+1&&"#text"===e.childNodes[m+1].nodeName;)if(m+=1,t.childNodes[o].data===e.childNodes[m].data){d=!0;break}if(!d)return g.push((new a).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n.concat(o)).setValue(this.options._const.oldValue,h.data).setValue(this.options._const.newValue,t.childNodes[o].data)),g}g.push((new a).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,n.concat(o)).setValue(this.options._const.value,h.data)),i.splice(o,1),_=Math.min(i.length,l.length),o-=1}else g.push((new a).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,n.concat(o)).setValue(this.options._const.element,p(h))),i.splice(o,1),_=Math.min(i.length,l.length),o-=1;else if(!0===l[o])"#text"===(h=t.childNodes[o]).nodeName?(g.push((new a).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,n.concat(o)).setValue(this.options._const.value,h.data)),i.splice(o,0,!0),_=Math.min(i.length,l.length),V-=1):(g.push((new a).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,n.concat(o)).setValue(this.options._const.element,p(h))),i.splice(o,0,!0),_=Math.min(i.length,l.length),V-=1);else if(i[o]!==l[o]){if(g.length>0)return g;if(u=s[i[o]],(r=Math.min(u.newValue,e.childNodes.length-u.length))!==u.oldValue){c=!1;for(let t=0;t<u.length;t+=1)f(e.childNodes[r+t],e.childNodes[u.oldValue+t],[],!1,!0)||(c=!0);if(c)return[(new a).setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",u.length).setValue(this.options._const.from,u.oldValue).setValue(this.options._const.to,r).setValue(this.options._const.route,n)]}}return g}findValueDiff(e,t,s){const n=[];return e.selected!==t.selected&&n.push((new a).setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,s)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&n.push((new a).setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,s)),e.checked!==t.checked&&n.push((new a).setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,s)),n}}const j={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff(e,t,s,n){e.data=n},preVirtualDiffApply(){},postVirtualDiffApply(){},preDiffApply(){},postDiffApply(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(!window||!window.document)&&window.document};class S{constructor(e={}){if(this.options=e,Object.entries(j).forEach(([e,t])=>{Object.prototype.hasOwnProperty.call(this.options,e)||(this.options[e]=t)}),!this.options._const){const e=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this.options._const={},this.options.compress?e.forEach((e,t)=>this.options._const[e]=t):e.forEach(e=>this.options._const[e]=e)}this.DiffFinder=R}apply(e,t){return n(e,t,this.options)}undo(e,t){return l(e,t,this.options)}diff(e,t){return new this.DiffFinder(e,t,this.options).init()}}const I=Symbol();class M{constructor(e){this._relientObjects=[],this.relatedNodes=[],this._value=e}hasRelatedNodes(){return this.relatedNodes.length>0}addRelient(e){this._relientObjects.push(e)}get value(){return this._value}set value(e){this._value=e,e&&e.constructor===Array?(this.relatedNodes=[],e.forEach(e=>{e.isVElement&&this.relatedNodes.push(e)})):e&&e.isVElement&&(this.relatedNodes=[e]);for(let e=0;e<this._relientObjects.length;e++)this._relientObjects[e].setRelientStateDirty(this)}get[I](){return!0}[Symbol.iterator](){return function*(e){yield e}(this._value)}}function L(e){return new M(e)}function $(...e){let t=[],s={get value(){let t="";for(let s=0;s<e.length;s++)e[s]&&e[s][I]?t+=e[s].value:e[s]&&(t+=e[s]);return t},addRelient(e){t.push(e)},setRelientStateDirty(){t.forEach(function(e){e.setRelientStateDirty&&e.setRelientStateDirty(s)})},[I]:!0};for(let t=0;t<e.length;t++)e[t]&&e[t][I]&&e[t].addRelient(s);return s}var F;const J=Symbol();class B{constructor(){if(this.WARNIFINRENDER=0,this._initialized=!1,this._relient=[],this[F]=!0,!this.renderFunctionExists())throw new Error("Components must define a render function")}renderFunctionExists(){return this.render instanceof Function}renderInternal(){if(!this._initialized){let e=Object.keys(this);for(let t=0;t<e.length;t++)this[e[t]][I]&&this[e[t]].addRelient(this);this._initialized=!0}this.WARNIFINRENDER++;let e=this.render();return this.WARNIFINRENDER--,this._element?this._element.diff(e):this._element=e,this._element.element}get element(){return this.renderInternal()}render(){}rerender(){if(this.WARNIFINRENDER&&console.warn("rerender initiated from within the render call, this should be avoided if posible"),this.WARNIFINRENDER>10)return console.error("rerender error: rerender is being called within render several times in a row, this most likeally means that there is an issue."),null;return this.renderInternal()}addRelient(e){this._relient.includes(e)||this._relient.push(e)}setRelientStateDirty(e){this.rerender()}get[(F=J,I)](){return!0}}const G=new S;function P(e){for(let t=0;t<e.length;t++)e[t]&&e[t].constructor===Array&&e.splice(t,1,...e[t]);return e}function U(e){let t=[];const s=Object.keys(e);for(let n=0;n<s.length;n++){const o=s[n];e[o]&&e[o][I]?t.push(e[o]):"object"==typeof e[o]&&t.push(...U(e[o]))}return t}function z(e,t){const s=Object.keys(t);for(let n=0;n<s.length;n++){const o=s[n],i=t[o];i&&i[I]?e[o]=i.value:e[o]=i}}class H{constructor(e){this.references=new Map,this.initializer=e,this.elements=[],this.elements instanceof Array||(this.elements=[this.elements]),this.render()}render(){for(let e=0;e<this.elements.length;e++)this.elements[e].element.remove();this.elements=this.initializer();for(let e=0;e<this.elements.length;e++){const t=[...this.elements[e].references.keys()];for(let s=0;s<t.length;s++)this.references.has(t[s])||this.references.set(t[s],[]),this.references.get(t[s]).push(this.elements[e]),t[s].addRelient(this)}}setRelientStateDirty(e){this.references.get(e)}}class W{constructor(e,t,s){this.childrefs=[],this.references=new Map;const n=P(s);this.type=e,this.props=t||{},this.children=n,this.states=[],this.element=document.createElement(this.type);for(let e=0;e<this.children.length;e++){let t=W.resolve(this.children[e]);if(this.children[e]&&this.children[e][I])this.states.push(this.children[e]),this.references.has(this.children[e])||this.references.set(this.children[e],[]),this.references.get(this.children[e]).push(t),this.element.appendChild(t);else if(this.children[e]instanceof Function){this.childrefs[e]=new H(this.children[e]);let t=this.childrefs[e].elements;for(let e=0;e<t.length;e++)this.element.appendChild(t[e].element)}else this.element.appendChild(t)}const o=Object.keys(this.props);if(this.props)for(let e=0;e<o.length;e++){const t=o[e];if(this.props[t]&&this.props[t][I])this.states.push(this.props[t]),this.references.has(this.props[t])||this.references.set(this.props[t],[]),this.references.get(this.props[t]).push(t);else if("object"==typeof this.props[t]){const e=U(this.props[t]);for(let s=0;s<e.length;s++)e[s].addRelient(this),this.states.push(e[s]),this.references.has(e[s])||this.references.set(e[s],[]),this.references.get(e[s]).push(t)}}for(let e=0;e<o.length;e++){const s=o[e];this.props[s]&&this.props[s][I]?this.element[s]=t[s].value:"object"==typeof t[s]?(z(this.element[s],t[s]),"on"!==s.substr(0,2)&&this.element.setAttribute(s,this.element[s].value)):(this.element[s]=t[s],"on"!==s.substr(0,2)&&this.element.setAttribute(s,this.element[s]))}for(let e=0;e<this.states.length;e++)this.states[e].addRelient(this)}setRelientStateDirty(e){const t=this.references.get(e);for(let s=0;s<t.length;s++){const n=t[s];n instanceof Text?n.textContent=e.value:n instanceof HTMLSpanElement&&n.hasAttribute("is-state-wrapper")?(e.hasRelatedNodes()&&e.relatedNodes.forEach(t=>{e.relatedNodes.includes(t)||t.element.remove()}),e.value.forEach(e=>{n.appendChild(e.element)})):"string"==typeof n&&(this.props[n]&&this.props[n][I]?this.element[n]=this.props[n].value:this.props[n]instanceof Object&&z(this.element[n],this.props[n]))}}static resolve(e){if(e instanceof W)return e.element;if(void 0!=e&&e[I]){if(e.value&&e.value.constructor===Array){let t=document.createElement("span");t.setAttribute("is-state-wrapper","true");for(let s=0;s<e.value.length;s++)t.appendChild(W.resolve(e.value[s]));return t}return e[J]?e.renderInternal():document.createTextNode(e.value)}return Object.getPrototypeOf(e)instanceof B?e.element:document.createTextNode(void 0!=e?e:" ")}get isVElement(){return!0}diff(e){return G.apply(this.element,G.diff(this.element,e.element))}}function X(e,t,...s){return"function"==typeof e?Object.getPrototypeOf(e)===B?new e(Object.assign({},t||{},{children:s})):e(Object.assign({},t||{},{children:s})):new W(e,t,s)}const Z=document.createElement("style");Z.setAttribute("fw-style","true");const q=new Map;function K(e){if(q.has(e)){const t=q.get(e)+1;return q.set(e,t),e+"-"+t}return q.set(e,0),e}function Q(e){let t={},s={},n=Object.keys(e);for(let o=0;o<n.length;o++){let i=n[o],l=K(i);t[l]=e[i],s[i]=l}let o=[];function i(e,t){let s=[],n=Object.keys(e);for(let o=0;o<n.length;o++){let l=n[o];"object"==typeof e[l]?i(e[l],t+l):s.push(l.replace(/[A-Z]/g,e=>"-"+e.toLowerCase())+":"+e[l])}o.push(`${t}{${s.join(";")}}`)}let l=Object.keys(t);for(let e=0;e<l.length;e++)o.push(i(t[l[e]],l[e]));let a=o.join("\n");return Z.innerHTML+=a,s}Q.raw=function(e){Z.innerHTML+="/*raw*/\n\n"+e+"\n/*end raw*/\n"},document.head?document.head.appendChild(Z):document.addEventListener("load",()=>{document.head.appendChild(Z)});const Y=Q;var ee={dom:X,StatefulData:L,stateJoin:$,makeStyles:Y,Component:B};export const fw=ee;